<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Salsa Demo Programs: /home/jenkins/workspace/SalsaDemos/Onza/RangingDemo/ranging_demo.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Salsa Demo Programs
   &#160;<span id="projectnumber">2016-05-03</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_43e0a1f539e00dcfa1a6bc4d4fee4fc2.html">home</a></li><li class="navelem"><a class="el" href="dir_337c3a93990b7dbc7695d613ed19043e.html">jenkins</a></li><li class="navelem"><a class="el" href="dir_66e3ff4cadd89b6e62cafb2105835506.html">workspace</a></li><li class="navelem"><a class="el" href="dir_7afc540aa59c01078fb11ff79218d290.html">SalsaDemos</a></li><li class="navelem"><a class="el" href="dir_b89902c1c2b19a0b2c657274bcbe88bb.html">Onza</a></li><li class="navelem"><a class="el" href="dir_4ee11248cefc91f8d8602b6b8709a747.html">RangingDemo</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ranging_demo.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;getopt.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;cluttermap.h&quot;</code><br />
<code>#include &quot;radarDSP.h&quot;</code><br />
<code>#include &quot;fex4.h&quot;</code><br />
<code>#include &quot;<a class="el" href="utility_8h_source.html">../../Common/inc/utility.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="onza_helper_8h_source.html">../Helpers/onzaHelper.h</a>&quot;</code><br />
</div>
<p><a href="ranging__demo_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aed8c37fd6aaacee448c1660f09f11ed5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ranging__demo_8c.html#aed8c37fd6aaacee448c1660f09f11ed5">SHOW_DEBUG_SETTINGS</a></td></tr>
<tr class="separator:aed8c37fd6aaacee448c1660f09f11ed5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbb32e6744a151dde6686dbc26bdd342"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ranging__demo_8c.html#adbb32e6744a151dde6686dbc26bdd342">BIAS</a>&#160;&#160;&#160;(0.86) /* Distance error adjustment (m) */</td></tr>
<tr class="separator:adbb32e6744a151dde6686dbc26bdd342"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15dcb9e1d5b6026b744acad01c82758d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ranging__demo_8c.html#a15dcb9e1d5b6026b744acad01c82758d">ADAPTIVE_ALPHA</a>&#160;&#160;&#160;(0.97) /* Remove 97% of clutter */</td></tr>
<tr class="separator:a15dcb9e1d5b6026b744acad01c82758d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b3a4dedb5d9c396d51af7a874ec3bfb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ranging__demo_8c.html#a6b3a4dedb5d9c396d51af7a874ec3bfb">ADAPTIVE_BETA</a>&#160;&#160;&#160;(0.70) /* Controls amount of new signal added to clutter */</td></tr>
<tr class="separator:a6b3a4dedb5d9c396d51af7a874ec3bfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33c404e12a72847a9cc1e8c1c3778515"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ranging__demo_8c.html#a33c404e12a72847a9cc1e8c1c3778515">DEFAULT_Y_MAX</a>&#160;&#160;&#160;(2e-1)</td></tr>
<tr class="separator:a33c404e12a72847a9cc1e8c1c3778515"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a683b8802cf411481d950d0471fdf10b6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ranging__demo_8c.html#a683b8802cf411481d950d0471fdf10b6">Y_AXIS_ADJUST_COUNTS</a>&#160;&#160;&#160;(30)</td></tr>
<tr class="separator:a683b8802cf411481d950d0471fdf10b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4787c9240e2ed69c0e368e58b0bdf6b0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ranging__demo_8c.html#a4787c9240e2ed69c0e368e58b0bdf6b0">TARGET_THRES_STATIC</a>&#160;&#160;&#160;(0.2)</td></tr>
<tr class="separator:a4787c9240e2ed69c0e368e58b0bdf6b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39f59178b983f7d9c029bacdc9bf95b3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ranging__demo_8c.html#a39f59178b983f7d9c029bacdc9bf95b3">TARGET_THRES_ADAPTIVE</a>&#160;&#160;&#160;(0.05)</td></tr>
<tr class="separator:a39f59178b983f7d9c029bacdc9bf95b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ranging__demo_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a15dcb9e1d5b6026b744acad01c82758d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15dcb9e1d5b6026b744acad01c82758d">&#9670;&nbsp;</a></span>ADAPTIVE_ALPHA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADAPTIVE_ALPHA&#160;&#160;&#160;(0.97) /* Remove 97% of clutter */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranging__demo_8c_source.html#l00197">197</a> of file <a class="el" href="ranging__demo_8c_source.html">ranging_demo.c</a>.</p>

</div>
</div>
<a id="a6b3a4dedb5d9c396d51af7a874ec3bfb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b3a4dedb5d9c396d51af7a874ec3bfb">&#9670;&nbsp;</a></span>ADAPTIVE_BETA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADAPTIVE_BETA&#160;&#160;&#160;(0.70) /* Controls amount of new signal added to clutter */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranging__demo_8c_source.html#l00198">198</a> of file <a class="el" href="ranging__demo_8c_source.html">ranging_demo.c</a>.</p>

</div>
</div>
<a id="adbb32e6744a151dde6686dbc26bdd342"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbb32e6744a151dde6686dbc26bdd342">&#9670;&nbsp;</a></span>BIAS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BIAS&#160;&#160;&#160;(0.86) /* Distance error adjustment (m) */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranging__demo_8c_source.html#l00194">194</a> of file <a class="el" href="ranging__demo_8c_source.html">ranging_demo.c</a>.</p>

</div>
</div>
<a id="a33c404e12a72847a9cc1e8c1c3778515"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a33c404e12a72847a9cc1e8c1c3778515">&#9670;&nbsp;</a></span>DEFAULT_Y_MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_Y_MAX&#160;&#160;&#160;(2e-1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranging__demo_8c_source.html#l00201">201</a> of file <a class="el" href="ranging__demo_8c_source.html">ranging_demo.c</a>.</p>

</div>
</div>
<a id="aed8c37fd6aaacee448c1660f09f11ed5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed8c37fd6aaacee448c1660f09f11ed5">&#9670;&nbsp;</a></span>SHOW_DEBUG_SETTINGS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SHOW_DEBUG_SETTINGS</td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="anchor" id="bbb_onza_ranging_demo"></a> </p><h1>Ranging Demo</h1>
<p>This is a simple program which demonstrates simple ranging; this program is based on the Onza's <em>ClutterDemo</em> project.</p>
<p>This version also incorporates the "zone" sense concept. When the signal is plotted, the color is based on what zone the target is in, or whether a target is detected at all.</p>
<h2>Hardware Setup</h2>
<p>For this demo, a BeagleBone Black + Onza cape + LTSA 5 antennas were used. The orientation doesn't matter.</p>
<h2>Demonstration Code</h2>
<p>This program builds on code from the ClutterDemo project. In addition to the prior functionality, the program demonstrates the use of some DSP techniques.</p>
<p>The fex4_getRawFrame() function is used to get a raw radar frame. This "raw" frame consists of uint32_t DAC counts. The clutter map API also works on integer type values. <em>However, typically floating-point signals are used when working with DSP functions. The static cluttermap only works on integers.</em></p>
<p>Once the clutter has been removed, the resultant signal consists of integer values. In the next step, this integer array is converted into a floating-point array. The signal mean is removed and the envelope of that is determined. The maximum of this envelope is used to determine the distance to the target.</p>
<p>In addition to the signal plot, some values are echoed to the terminal such as the distance to the maximum peak of the envelope signal, and the zone the target is in.</p>
<h3>Command-line Options</h3>
<p>The command-line options:</p><ul>
<li>-a : enable the adaptive clutter map</li>
</ul>
<h3>Demo in Action</h3>
<p>The radar was placed on a table with the antennas facing horizontally. A metal plate was attached to the front of a cart which was moved toward and away from the radar.</p>
<p>There are two #define which effect what is displayed</p><ul>
<li>SHOW_DEBUG_SETTINGS</li>
<li>SHOW_LIVE_SETTINGS</li>
</ul>
<p>When SHOW_DEBUG_SETTINGS is defined some contextual output is shown on the console display.</p>
<p>Console output: </p><pre class="fragment">INFO: fex4: DVDD TX OK
INFO: fex4: DVDD RX OK
INFO: fex4: AVDD TX OK
INFO: fex4: AVDD RX OK
INFO: fex4: XOSC lock: True
INFO: fex4: Common PLL lock: True
INFO: fex4: TX PLL lock: True
INFO: fex4: RX PLL lock: True
Offset distance = 0.373714 m (biased)
Sample Delay = 8.230453 ns
Sampling Rate = 23328000000
Sample Resolution = 0.0064 m
Number of samplers = 1536
Starting radar loop... (hit ESC key to quit)
</pre><p>By default the initial radar signal is used to set a static clutter map; this can work well if it's possible to remove any targets from view before starting the program. Alternatively, program can be started with the the -a command-line option to enable an adaptive filter.</p>
<dl class="section note"><dt>Note</dt><dd>When using the static cluttermap any targets in view will be part of the static cluttermap. When said target moves, you may notice two reflections for a single target. One would represent the true target reflection. The other would be a stationary reflection of where the target <em>was</em> during the initial radar signal.</dd>
<dd>
Keep in mind, the target threshold may need to be tuned for your environment.</dd></dl>
<p>When the SHOW_LIVE_SETTINGS is defined some additional info including the range estimate.</p>
<p>Console output: </p><pre class="fragment">swing=    761, max * 1e3=  950.191, d= 1.96
swing=    752, max * 1e3=  958.433, d= 1.96
swing=    780, max * 1e3=  968.173, d= 1.97
swing=    765, max * 1e3=  967.960, d= 1.96
swing=    763, max * 1e3=  982.330, d= 1.96
swing=    791, max * 1e3=  948.919, d= 1.96
swing=    768, max * 1e3=  959.416, d= 1.96
swing=    782, max * 1e3=  975.224, d= 1.96
swing=    752, max * 1e3=  953.624, d= 1.96
swing=    765, max * 1e3=  921.878, d= 1.96
swing=    762, max * 1e3=  965.925, d= 1.96
</pre><p>When the SHOW_LIVE_SETTINGS is <em>not</em> defined, the output changes. This time, the distance (in meters) and zone is shown. In the DSP the target is defined as the largest peak in the envelope. If the peak amplitude is below the a threshold, then the output will display "No target...".</p>
<pre class="fragment">distance =  2.147, [   2   ]
distance =  2.109, [   2   ]
distance =  2.096, [   2   ]
distance =  2.064, [   2   ]
distance =  2.038, [   2   ]
distance =  1.999, [ 1     ]
distance =  1.993, [ 1     ]
distance =  1.948, [ 1     ]
distance =  1.935, [ 1     ]
distance =  1.909, [ 1     ]
distance =  1.877, [ 1     ]
distance =  1.858, [ 1     ]
</pre><p>The envelope signal is plotted below. The maximum peak was used to determine the reported distance.</p>
<p>The y-axis is not labeled. Before processing, the signal with clutter removed is normalized to volts. The signal processing consisting of the envelope and filtering adds "processing gain" so the vertical axis is unit-less.</p>
<div class="image">
<img src="onza_zone_1.png" alt="onza_zone_1.png"/>
<div class="caption">
Signal Envelope</div></div>
<p>There are three zones defined for the this demo. When the target is within 2 m, the plot will display as red. When the target is between 2 and 3 m, then plot will display orange.</p>
<div class="image">
<img src="onza_zone_2.png" alt="onza_zone_2.png"/>
<div class="caption">
Signal Envelope</div></div>
<p>When the target exceeds 3 m, the plot will display green.</p>
<div class="image">
<img src="onza_zone_3.png" alt="onza_zone_3.png"/>
<div class="caption">
Signal Envelope</div></div>
<p>If the peak amplitude is below the threshold, the plot will display blue.</p>
<h3>User Enhancements</h3>
<p>A simple 10-pt moving average filter was used to smooth out the envelope. This was simple to implement as an example, but a better filter should improve the distance estimation consistency.</p>
<p>The target threshold was determined based on limited testing. Depending on the environment and the target, you may notice the the threshold is too high or too low. Additionally, the target decision is based on the amplitude of the last processed signal.</p>
<dl class="section user"><dt>Environment</dt><dd>BeagleBone Black + Onza cape</dd></dl>
<dl class="section user"><dt>Compiler</dt><dd>GNU GCC</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Justin Hadella</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2015 by FlatEarth, Inc </dd></dl>

<p class="definition">Definition at line <a class="el" href="ranging__demo_8c_source.html#l00187">187</a> of file <a class="el" href="ranging__demo_8c_source.html">ranging_demo.c</a>.</p>

</div>
</div>
<a id="a39f59178b983f7d9c029bacdc9bf95b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39f59178b983f7d9c029bacdc9bf95b3">&#9670;&nbsp;</a></span>TARGET_THRES_ADAPTIVE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TARGET_THRES_ADAPTIVE&#160;&#160;&#160;(0.05)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranging__demo_8c_source.html#l00208">208</a> of file <a class="el" href="ranging__demo_8c_source.html">ranging_demo.c</a>.</p>

</div>
</div>
<a id="a4787c9240e2ed69c0e368e58b0bdf6b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4787c9240e2ed69c0e368e58b0bdf6b0">&#9670;&nbsp;</a></span>TARGET_THRES_STATIC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TARGET_THRES_STATIC&#160;&#160;&#160;(0.2)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranging__demo_8c_source.html#l00207">207</a> of file <a class="el" href="ranging__demo_8c_source.html">ranging_demo.c</a>.</p>

</div>
</div>
<a id="a683b8802cf411481d950d0471fdf10b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a683b8802cf411481d950d0471fdf10b6">&#9670;&nbsp;</a></span>Y_AXIS_ADJUST_COUNTS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Y_AXIS_ADJUST_COUNTS&#160;&#160;&#160;(30)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranging__demo_8c_source.html#l00204">204</a> of file <a class="el" href="ranging__demo_8c_source.html">ranging_demo.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranging__demo_8c_source.html#l00259">259</a> of file <a class="el" href="ranging__demo_8c_source.html">ranging_demo.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Feb 6 2019 16:32:47 for Salsa Demo Programs by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
