<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Salsa Demo Programs: /home/jenkins/workspace/SalsaDemos/Ancho/RangingDemo/main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Salsa Demo Programs
   &#160;<span id="projectnumber">2016-05-03</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_43e0a1f539e00dcfa1a6bc4d4fee4fc2.html">home</a></li><li class="navelem"><a class="el" href="dir_337c3a93990b7dbc7695d613ed19043e.html">jenkins</a></li><li class="navelem"><a class="el" href="dir_66e3ff4cadd89b6e62cafb2105835506.html">workspace</a></li><li class="navelem"><a class="el" href="dir_7afc540aa59c01078fb11ff79218d290.html">SalsaDemos</a></li><li class="navelem"><a class="el" href="dir_c47e70f5dc48ff09c30dc9b1fb25cb6d.html">Ancho</a></li><li class="navelem"><a class="el" href="dir_3deb45af69ef0a9154bb77463bea84b1.html">RangingDemo</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">main.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;getopt.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;anchoHelper.h&quot;</code><br />
<code>#include &quot;radarHelper.h&quot;</code><br />
<code>#include &quot;cluttermap.h&quot;</code><br />
<code>#include &quot;radarDSP.h&quot;</code><br />
<code>#include &quot;Radarlib3.h&quot;</code><br />
<code>#include &quot;<a class="el" href="utility_8h_source.html">../../Common/inc/utility.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="normalize_8h_source.html">../../Common/inc/normalize.h</a>&quot;</code><br />
</div>
<p><a href="_ancho_2_ranging_demo_2main_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aed8c37fd6aaacee448c1660f09f11ed5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ancho_2_ranging_demo_2main_8c.html#aed8c37fd6aaacee448c1660f09f11ed5">SHOW_DEBUG_SETTINGS</a></td></tr>
<tr class="separator:aed8c37fd6aaacee448c1660f09f11ed5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15dcb9e1d5b6026b744acad01c82758d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ancho_2_ranging_demo_2main_8c.html#a15dcb9e1d5b6026b744acad01c82758d">ADAPTIVE_ALPHA</a>&#160;&#160;&#160;(0.97) /* Remove 97% of clutter */</td></tr>
<tr class="separator:a15dcb9e1d5b6026b744acad01c82758d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b3a4dedb5d9c396d51af7a874ec3bfb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ancho_2_ranging_demo_2main_8c.html#a6b3a4dedb5d9c396d51af7a874ec3bfb">ADAPTIVE_BETA</a>&#160;&#160;&#160;(0.70) /* Controls amount of new signal added to clutter */</td></tr>
<tr class="separator:a6b3a4dedb5d9c396d51af7a874ec3bfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fdc222a6cacb479a739af95e86406ac"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ancho_2_ranging_demo_2main_8c.html#a6fdc222a6cacb479a739af95e86406ac">DEFAULT_Y_MIN</a>&#160;&#160;&#160;(1e-2)</td></tr>
<tr class="separator:a6fdc222a6cacb479a739af95e86406ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a683b8802cf411481d950d0471fdf10b6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ancho_2_ranging_demo_2main_8c.html#a683b8802cf411481d950d0471fdf10b6">Y_AXIS_ADJUST_COUNTS</a>&#160;&#160;&#160;(30)</td></tr>
<tr class="separator:a683b8802cf411481d950d0471fdf10b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5ae07f63d6b390e42068d941038dadf2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ancho_2_ranging_demo_2main_8c.html#a5ae07f63d6b390e42068d941038dadf2">Usage</a> ()</td></tr>
<tr class="separator:a5ae07f63d6b390e42068d941038dadf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ancho_2_ranging_demo_2main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a15dcb9e1d5b6026b744acad01c82758d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15dcb9e1d5b6026b744acad01c82758d">&#9670;&nbsp;</a></span>ADAPTIVE_ALPHA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADAPTIVE_ALPHA&#160;&#160;&#160;(0.97) /* Remove 97% of clutter */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html#l00118">118</a> of file <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a id="a6b3a4dedb5d9c396d51af7a874ec3bfb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b3a4dedb5d9c396d51af7a874ec3bfb">&#9670;&nbsp;</a></span>ADAPTIVE_BETA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADAPTIVE_BETA&#160;&#160;&#160;(0.70) /* Controls amount of new signal added to clutter */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html#l00119">119</a> of file <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a id="a6fdc222a6cacb479a739af95e86406ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fdc222a6cacb479a739af95e86406ac">&#9670;&nbsp;</a></span>DEFAULT_Y_MIN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_Y_MIN&#160;&#160;&#160;(1e-2)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html#l00122">122</a> of file <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a id="aed8c37fd6aaacee448c1660f09f11ed5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed8c37fd6aaacee448c1660f09f11ed5">&#9670;&nbsp;</a></span>SHOW_DEBUG_SETTINGS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SHOW_DEBUG_SETTINGS</td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="anchor" id="bbb_ancho_ranging_demo"></a> </p><h1>RangingDemo</h1>
<p>This is a simple program which demonstrates simple ranging; this program is based on the <em>ClutterDemo</em> project.</p>
<h2>Hardware Setup</h2>
<p>For this demo, a BeagleBone Black + an Ancho cape + Sinuous antenna cape was used.</p>
<h2>Demonstration Code</h2>
<p>This program builds on code from the ClutterDemo project. In addition to the prior functionality, the program demonstrates the use of some DSP techniques.</p>
<p>The radarHelper_getFrameRaw() function is used to get a raw radar frame. This "raw" frame consists of uint32_t DAC counts. The clutter map API also works on integer type values. However, typically floating-point signals are used when working with DSP functions.</p>
<p>Once the clutter has been removed, the resultant signal consists of integer values. In the next step, this integer array is converted into a floating-point array. The signal mean is removed and the envelope of that is determined. The maximum of this envelope is used to determine the distance to the target.</p>
<p>In addition to the signal plot, some values are echoed to the terminal such as the distance to the maximum peak of the envelope signal.</p>
<h3>Command-line Options</h3>
<p>There are several command-line options:</p><ul>
<li>-c : execute the radar timing measurement</li>
<li>-o : save the JSON configuration to a file</li>
<li>-a : enable the adaptive clutter map</li>
</ul>
<h3>Demo in Action</h3>
<p>The radar was placed on a table with the antennas facing up towards the ceiling. By default, the initial radar signal was used to set the static clutter map. Once the demo started running, a small metal plate was moved up/down over the radar.</p>
<p>Console output: </p><pre class="fragment">swing= 293605, max * 1e3=   93.271, d= 0.45
swing= 310711, max * 1e3=   87.940, d= 0.45
swing= 328698, max * 1e3=   92.976, d= 0.42
swing= 343400, max * 1e3=   90.925, d= 0.42
swing= 340855, max * 1e3=   93.109, d= 0.41
swing= 308983, max * 1e3=   92.599, d= 0.42
swing= 277406, max * 1e3=   91.078, d= 0.42
swing= 297849, max * 1e3=   89.554, d= 0.39
swing= 331532, max * 1e3=   89.965, d= 0.39
</pre><p>The envelope signal is plotted below. The maximum peak was used to determine the reported distance.</p>
<p>The y-axis is not labeled. Before processing, the signal with clutter removed is normalized to volts. The signal processing consisting of the envelope and filtering adds "processing gain" so the vertical axis is unit-less.</p>
<div class="image">
<img src="ancho_demo_ranging.png" alt="ancho_demo_ranging.png"/>
<div class="caption">
Signal Envelope</div></div>
<h3>User Enhancements</h3>
<p>A simple 10-pt moving average filter was used to smooth out the envelope. This was simple to implement as an example, but a better filter should improve the distance estimation consistency.</p>
<p>In the demo's current form, nothing is done with processed signal's max value. So, when no target is in view, the DSP will still estimate a distance to some peak. A simple modification would be to examine the max value against a user threshold to determine whether the distance estimate should be used or not. For example, experiment with and without targets in view and see how the max value changes.</p>
<dl class="section user"><dt>Environment</dt><dd>BeagleBone Black + Ancho cape</dd></dl>
<dl class="section user"><dt>Compiler</dt><dd>GNU GCC</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Justin Hadella</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2015 by FlatEarth, Inc </dd></dl>

<p class="definition">Definition at line <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html#l00110">110</a> of file <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a id="a683b8802cf411481d950d0471fdf10b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a683b8802cf411481d950d0471fdf10b6">&#9670;&nbsp;</a></span>Y_AXIS_ADJUST_COUNTS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Y_AXIS_ADJUST_COUNTS&#160;&#160;&#160;(30)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html#l00125">125</a> of file <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html#l00182">182</a> of file <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a id="a5ae07f63d6b390e42068d941038dadf2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ae07f63d6b390e42068d941038dadf2">&#9670;&nbsp;</a></span>Usage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Usage </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html#l00164">164</a> of file <a class="el" href="_ancho_2_ranging_demo_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Feb 6 2019 16:32:47 for Salsa Demo Programs by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
